  GOAL
--------------------------------------------------------
1. **Gate the chat box** so a user canâ€™t type until a contract
   PDF / Word is uploaded.
2. After upload, show a single pop-up that asks:
      â€œWhich party are you representing?â€
      â€¢ First Party   â€¢ Second Party   â€¢ General Analysis
   (This already exists but is not firing consistentlyâ€”fix it.)
3. Only after the user clicks one of the three buttons should
   the chat input unlock and streaming begin.

========================================================
ğŸ”’  DO-NOT-TOUCH
--------------------------------------------------------
â€¢ Header, sidebar, colours, fonts, spacing, dark/light themes
â€¢ Working send/stream pipeline
â€¢ RECENT CONTRACTS saving logic
â€¢ Home/marketing pages

========================================================
ğŸ›   IMPLEMENTATION
--------------------------------------------------------
1. **Disable chat bar by default**  
   <ChatInput> gets `disabled={true}` until
   `conversationState === "ready"`.

2. **Upload flow**  
   â€¢ When â€œ+ New Contract Chatâ€ or the paper-clip icon is used:
       â€“ Accept .pdf / .doc / .docx (keep existing validator).  
       â€“ Save file metadata (`fileId`, `fileName`, `fileSize`).  
       â€“ Set `conversationState = "awaitingParty"`.

3. **Party-selection pop-up**  
   â€¢ Render a modal centred on the screen:
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Which party are you representing?         â”‚
     â”‚  [First Party]  [Second Party]  [General] â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â€¢ Buttons use accent colour #B7DEE8 when hovered / focused.  
   â€¢ Clicking a button stores `partyRole` in chat context and
     sets `conversationState = "ready"` â†’ chat bar enabled.  
   â€¢ ESC or outside-click should **not** close the modal
     (force a selection).

4. **Guard send handler**  
   â€¢ In `handleSend`, early-return with a toast
     â€œPlease upload a contract firstâ€ if state !== "ready".

5. **Accessibility**  
   â€¢ Pop-up is focus-trapped: first tab lands on First Party,
     Shift-Tab cycles back.  
   â€¢ aria-label on modal: `"Select party role"`.

========================================================
âœ…  DONE CHECKLIST
--------------------------------------------------------
â˜ Chat box shows a greyed-out placeholder until a file is uploaded.  
â˜ Uploading a contract opens the party-selection modal every time.  
â˜ Choosing a role closes the modal and unlocks the chat bar.  
â˜ Messages stream as before, and thread is saved to RECENT CONTRACTS.  
â˜ No console errors; dark/light & RTL behaviour unchanged.  
â˜ Log **CONTRACT GATE READY** in console when finished.