**Problem Description:**

There are two critical issues affecting the application:

1.  **Analytics Dashboard Not Reflecting Data from Newly Uploaded Contracts:** Despite new contracts appearing in the "Recent Contracts" sidebar (e.g., "Qsalary Contract - [1]"), the main Analytics & Reports dashboard does not update to reflect their data. Specifically, sections like "Payment Terms," "Breach Notice," and "Termination Notice" show "No data available," and other charts (Internal Parties, Counterparties, Governing Law) appear to be based on an incomplete or outdated dataset, not incorporating the newly uploaded contract details.

2.  **Application Not Redirecting to Chatbar After Contract Upload:** After a contract is successfully uploaded, the application does not automatically navigate the user to the chatbar or the specific chat interface for the newly uploaded contract. This disrupts the user workflow, requiring manual navigation.

**Objective for Replit Agent:**

Diagnose and resolve both issues to ensure:

1.  The Analytics & Reports dashboard accurately and comprehensively reflects data from *all* uploaded contracts, including newly added ones, populating all relevant charts (Contract Type, Executed Status, Language, Internal Parties, Counterparties, Governing Law, Payment Terms, Breach Notice, and Termination Notice).
2.  The application automatically redirects the user to the chatbar or the specific chat interface for the newly uploaded contract immediately after a successful upload.

**Specific Tasks & Troubleshooting Steps:**

### For Issue 1: Analytics Dashboard Not Reflecting Data from Newly Uploaded Contracts

This issue points to a breakdown in the data pipeline from contract upload to dashboard visualization. The agent should investigate data extraction, storage, aggregation, and frontend rendering.

1.  **Verify Data Extraction and Storage for New Contracts:**
    *   **Action:** Upload a new test contract with clear, distinct data points for all relevant sections, especially Payment Terms, Breach Notice, and Termination Notice.
    *   **Action:** Immediately after upload, access the database (e.g., Replit Database, PostgreSQL, etc.) and directly inspect the record for this newly uploaded contract. Verify that *all* expected fields (including those previously showing "No data available" on the dashboard) have been extracted and stored correctly and completely.
    *   **Method:** Use the database client/shell (e.g., `replit-db` client, `psql`, `sqlite3`) to query the specific contract ID and examine its stored data.

2.  **Inspect Backend Aggregation Logic for New Data:**
    *   **Action:** Review the backend code responsible for aggregating data for the dashboard (e.g., the API endpoint that serves data to the Analytics page, and its associated functions).
    *   **Action:** Look for any logic that might prevent newly added contracts from being included in the aggregation. This includes: 
        *   Hardcoded limits or filters (e.g., date ranges, status flags) that might exclude recent data.
        *   Inefficient database queries that don't scan the entire dataset or miss new entries.
        *   Any caching mechanisms that are not being properly invalidated or refreshed upon new contract uploads.
    *   **Method:** Examine relevant backend files (e.g., Python Flask, Node.js Express) that handle data retrieval and aggregation. Pay close attention to database queries, loops, and conditional statements that process contract data.

3.  **Test Backend Analytics API Response After New Upload:**
    *   **Action:** After uploading a new contract, use `curl` from the Replit shell to hit the dashboard's analytics API endpoint (e.g., `http://localhost:5000/api/dashboard/data`).
    *   **Action:** Analyze the JSON response. Does it include data from the newly uploaded contract? Are the overall counts and percentages updated to reflect the new data? Are the Payment Terms, Breach Notice, and Termination Notice sections now populated in the API response?

4.  **Frontend Data Fetching and Rendering:**
    *   **Action:** If the backend API response (from step 3) is correct and comprehensive, but the frontend dashboard still doesn't update, investigate the frontend's data fetching and rendering logic.
    *   **Action:** Ensure the frontend component responsible for the dashboard is re-fetching data after a new contract upload. This might involve listening for a specific event, or a manual refresh trigger.
    *   **Action:** Check the browser's developer console for any JavaScript errors or network issues that might prevent the dashboard from processing or displaying the received data.

### For Issue 2: Application Not Redirecting to Chatbar After Contract Upload

This issue relates to the post-upload user experience flow.

1.  **Inspect Post-Upload Handler and Redirection Logic:**
    *   **Action:** Locate the code that executes immediately after a successful contract upload. This could be a frontend JavaScript function that handles the upload response, or a backend API endpoint that returns a redirection command.
    *   **Action:** Look for explicit redirection commands (e.g., `window.location.href = '...'`, `history.push('/chatbar')`, or a backend redirect response). Verify that the target URL or route for the chatbar is correct and accessible.

2.  **Verify Asynchronous Operation Completion:**
    *   **Action:** If the contract upload process involves asynchronous steps (e.g., saving to database, data extraction, indexing), ensure that the redirection only occurs *after* all critical post-upload tasks are fully completed and the new contract is ready for chat interaction.
    *   **Method:** Look for `await` keywords, Promises, or callbacks that ensure sequential execution before triggering the redirection.

3.  **Frontend Routing Configuration:**
    *   **Action:** If a frontend routing library (e.g., React Router, Vue Router) is used, verify its configuration for the chatbar route and how programmatic navigation is handled.

**Expected Outcome:**

*   The Replit agent should identify the specific reasons for both the analytics dashboard not updating and the chatbar redirection failure.
*   The agent should implement fixes for both identified issues.
*   The Analytics & Reports page should load successfully and display comprehensive, up-to-date data from all contracts, including the newly uploaded ones, across all charts.
*   Upon successful contract upload, the application should automatically redirect the user to the chatbar or the specific chat interface for the newly uploaded contract.

**Documentation:**

*   Provide a clear summary of the diagnostic steps taken and the findings for both issues.
*   Explain the root causes of each issue.
*   Detail the implemented solutions and any code changes made.

"""
